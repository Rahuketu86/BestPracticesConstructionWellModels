%% This is file `KualaLumpur.sty',
%% Modification to metropolis scheme created by Rob J Hyndman
%% Created by Alfonso R Reyes. 29 November 2018

% UTF8
\usepackage[utf8]{inputenc}

% Plenty of room
\setbeamersize{text margin left=2em,text margin right=2em}

% metropolis options
\metroset{progressbar=foot}

% KualaLumpur colours
\usecolortheme{KualaLumpur}
\usefonttheme{structurebold}

% Rounded corners on boxes
\useinnertheme{rounded}

% Lets make descriptions and alerts bold
\setbeamerfont{description item}{series=\bfseries}
\setbeamerfont{alerted text}{series=\bfseries}

% Redefine shaded environment if it exists (for R plots)
\ifcsname Shaded\endcsname
  \definecolor{shadecolor}{RGB}{225,225,225}
  \renewenvironment{Shaded}{\color{black}\begin{snugshade}\color{black}}{\end{snugshade}}
\fi

% Figure placement using textpos
\usepackage{graphicx}
\usepackage[absolute,overlay]{textpos}
\setlength{\TPHorizModule}{1cm}
\setlength{\TPVertModule}{1cm}
\def\placefig#1#2#3#4{\begin{textblock}{.1}(#1,#2)\rlap{\includegraphics[#3]{#4}}\end{textblock}}

\def\maxwidth{11.5cm}
\def\maxheight{8cm}
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}


\def\fullwidth#1{\vspace*{-0.2cm}\par\centerline{\includegraphics[width=20cm]{#1}}}
\def\fullheight#1{\vspace*{-0.2cm}\par\centerline{\includegraphics[height=12cm]{#1}}}

% Clever right hand placement
\newcommand*{\atright}[1]{{%
  \unskip\nobreak\hfill\penalty50
  \hskip2em\hbox{}\nobreak\hfill#1
  \parfillskip=0pt\finalhyphendemerits=0\par}}

% Slow reveal lists
\def\biz{\begin{itemize}[<+-| alert@+>]}
\def\eiz{\end{itemize}}
\def\ben{\begin{enumerate}[<+-| alert@+>]}
\def\een{\end{enumerate}}

% Fix dates
\usepackage[no-weekday]{eukdate}

% A more interesting and tighter font
\usepackage[lf,t]{carlito}

% Square bullets and enumerated items
\setbeamertemplate{items}[square]

% larger squares for enumeration
\defbeamertemplate{enumerate item}{mysquare}
{ \raisebox{-0.ex}{\hbox{%
    \usebeamerfont*{item projected}%
    \usebeamercolor{enumerate item}%
    \vrule width4ex height2.7ex depth.7ex%
    \hskip-4ex%
    \hbox to4ex{%
      \hfil%
      \color{LightGrey}\raisebox{.2ex}{\insertenumlabel}%
      \hfil}%
  }}%
}
[action]
{\setbeamerfont{item projected}{size=\scriptsize}}
\setbeamertemplate{enumerate item}[mysquare]
\setbeamertemplate{itemize item}[square]
\setbeamertemplate{items}[mysquare]

% This is for the outline and TOC
\setbeamertemplate{section in toc}[square]
\setbeamerfont{section number projected}{size=\large}
\setbeamercolor{section number projected}{bg=KualaGreen,fg=white}
\setbeamercolor{section in toc shaded}{fg=KualaGreenLight}
\setbeamercolor{section in toc}{fg=KualaNight}
\setbeamertemplate{section in toc shaded}[default][50]

\def\showtoc{\AtBeginSection[]{
  \frame<beamer>{
  \frametitle{Outline}
  \setcounter{tocdepth}{2}\vspace*{0.2cm}
  \tableofcontents[currentsection]
 }}}

\def\notoc{\AtBeginSection[]{}}

% Main title page
\setbeamerfont{title}{series=\bfseries,parent=structure,size=\LARGE}
\setbeamertemplate{title page}
{\placefig{-0.01}{-0.01}{width=1.01\paperwidth,height=1.01\paperheight}{KualaLumTitleSlide}
\begin{textblock}{7.5}(1,2.8)
{\color{white}\raggedright\usebeamerfont{title}\par\inserttitle}
\end{textblock}
\begin{textblock}{7.5}(1,7)
{\color{white}\raggedright{\insertauthor}\\[0.2cm]
\insertdate}
\end{textblock}}


% \addtobeamertemplate{footline}{}{%
% \begin{textblock*}{40mm}(.8\textwidth,8.5cm)
% \includegraphics[height=1cm,width=2cm]{cat}
% \end{textblock*}}


% \logo{\includegraphics[width=.3\textwidth]{cat}}

\setbeamertemplate{footline}[text line]{%
  \parbox{\linewidth}{\vspace*{-8pt}{Data Science for Petroleum Engineering}\hfill{Oil Gains Analytics LLC}\hfill\insertpagenumber}}
\setbeamertemplate{navigation symbols}{}


\showtoc

% Reduce vertical space around displayed equations

\usepackage{etoolbox}
\preto\frame{%
\setlength{\abovedisplayskip}{1pt}%
\setlength{\belowdisplayskip}{4pt}%
\setlength{\abovedisplayshortskip}{0pt}%
\setlength{\belowdisplayshortskip}{0pt}}

